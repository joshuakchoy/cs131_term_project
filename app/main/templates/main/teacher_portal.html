{% extends "base.html" %} {% block title %}Dashboard{% endblock %} {% block
content %}

<h1>Teacher Portal</h1>
<a class="teacher-btn" href="{{ url_for('main.create_assignment') }}">Create Assignment</a>
<a class="teacher-btn" href="{{ url_for('main.create_course') }}">Create Course</a>

<h2>Courses Taught</h2>
{% if courses and courses|length > 0 %}
<div class="courses-grid">
  {% for course in courses %}
  <div class="course-box">
    <div class="course-header">
      <h3 class="course-title">{{ course.title }}</h3>
      <p class="course-code">{{ course.code if course.code else "N/A" }}</p>
    </div>

    <div class="course-info">
      <div class="course-stat">
        <span class="stat-label">Students:</span>
        <span class="stat-value">{{ course.enrollments|length }}</span>
      </div>
      {% if course.description %}
      <p class="course-description">
        {{ course.description[:80] }}{% if course.description|length > 80
        %}...{% endif %}
      </p>
      {% endif %}
    </div>

    <div class="course-actions">
      <button
        class="btn-primary btn-edit"
        onclick="openCourseModal('modal-{{ course.id }}')"
      >
        âœŽ Edit
      </button>
    </div>
  </div>

  <div id="modal-{{ course.id }}" class="modal" style="display: none">
    <div class="modal-content">
      <div class="modal-header">
        <h2>{{ course.title }}</h2>
        <button
          class="close-btn"
          onclick="closeCourseModal('modal-{{ course.id }}')"
        >
          &times;
        </button>
      </div>

      <div class="modal-body">
        <div class="modal-section">
          <h3>Enrolled Students</h3>
          {% set enrolled = course.enrollments %} {% if enrolled and
          enrolled|length > 0 %}
          <ul class="enrolled-list">
            {% for e in enrolled %}
            <li>
              <strong>{{ e.student.username }}</strong> ({{ e.student.email }})
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p>No students enrolled.</p>
          {% endif %}
        </div>

        <div class="modal-section">
          <h3>All Students</h3>
          <p>Click "Add" to enroll a student in this course.</p>
          <div class="all-students-list">
            {% set enrolled_ids =
            course.enrollments|map(attribute='student_id')|list %} {% for s in
            students %} {% if s.id not in enrolled_ids %}
            <div class="student-row">
              <span class="student-name">{{ s.username }}</span>
              <span class="student-email">{{ s.email }}</span>
              <form
                method="POST"
                action="{{ url_for('main.enroll_student', course_id=course.id) }}"
                style="display: inline-block"
              >
                {{ form.hidden_tag() }}
                <input
                  type="hidden"
                  name="student_identifier"
                  value="{{ s.username }}"
                />
                <button type="submit" class="btn btn-add">+ Add</button>
              </form>
            </div>
            {% endif %} {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>

  {% endfor %}
</div>
{% else %}
<p>No courses found.</p>
{% endif %} {% endblock %}
