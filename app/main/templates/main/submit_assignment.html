{% extends "base.html" %}
{% block title %}{% if existing_submission %}Resubmit Assignment{% else %}Submit Assignment{% endif %}{% endblock %}

{% block content %}
<h1>{% if existing_submission %}Resubmit Assignment{% else %}Submit Assignment{% endif %}</h1>
<h2>{{ assignment.title }}</h2>
<p><strong>Due:</strong> {{ assignment.due_date }}</p>
{% if assignment.description %}
<p>{{ assignment.description }}</p>
{% endif %}
{% if existing_submission %}
<div class="alert alert-info">
  <strong>Previous submission:</strong> Submitted on {{ existing_submission.submitted_at.strftime('%Y-%m-%d %H:%M') }}
  {% if existing_submission.file_path %}
  <br><strong>File:</strong> {{ existing_submission.file_path }}
  {% endif %}
  {% if existing_submission.grade is not none %}
  <br><strong>Grade:</strong> {{ existing_submission.grade }}
  {% endif %}
  {% if existing_submission.feedback %}
  <br><strong>Teacher Feedback:</strong>
  <div style="background: #f9f9f9; padding: 10px; margin-top: 5px; border-radius: 4px;">
    {{ existing_submission.feedback }}
  </div>
  {% endif %}
</div>
{% endif %}

<form method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    
    <div class="form-group">
        {{ form.content.label }}<br>
        {{ form.content(rows=5, cols=50, class="form-control") }}<br>
        {% for error in form.content.errors %}
            <span style="color: red;">[{{ error }}]</span>
        {% endfor %}
    </div>
    
    <div class="form-group">
        {{ form.file.label }}<br>
        {{ form.file(class="form-control-file") }}<br>
        {% for error in form.file.errors %}
            <span style="color: red;">[{{ error }}]</span>
        {% endfor %}
        <small>Allowed file types: PDF, DOC, DOCX, TXT, ZIP, PY, JAVA, CPP, C (max 16MB)</small>
    </div>
    
    <p>
        {% if existing_submission %}
        <button type="submit" class="btn">Resubmit Assignment</button>
        {% else %}
        {{ form.submit(class="btn") }}
        {% endif %}
    </p>
</form>

<a href="{{ url_for('main.assignments') }}">Back to Assignments</a>
{% endblock %}
